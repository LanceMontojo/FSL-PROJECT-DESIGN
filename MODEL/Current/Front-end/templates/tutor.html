{% extends "base.html" %}
{% block title %}Learn - FSL Learning Platform{% endblock %}
{% block content %}

<style>
  .section .container { max-width: 1400px; }

  /* 3 equal columns; cards stretch to same height */
  .learn-grid{
    display:grid;
    grid-template-columns: repeat(3, minmax(0,1fr));
    gap:2rem;
    align-items:stretch;
  }
  @media (max-width: 1024px){ .learn-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); } }
  @media (max-width: 640px){  .learn-grid{ grid-template-columns: 1fr; } }

  /* equal-height cards (~half screen) */
  .category-card .card{
    min-height: 50vh;
    display:flex; flex-direction: column;
    padding: 1.75rem;
    border-radius: 22px;
    box-shadow: 0 14px 40px rgba(20,30,60,.14);
    background: rgba(255,255,255,.92);
  }

  /* header row */
  .learn-title{ font-size: 2rem; line-height: 1.15; margin: 0; }
  .pill{
    display:inline-flex; align-items:center; padding:.46rem .8rem;
    border-radius:999px; font-weight:700; font-size:.9rem;
    background: rgba(245,246,250,.9); border:1px solid rgba(15,23,42,.08);
    white-space: nowrap;
  }
  .pill.primary{  background:#eef2ff;border-color:#e0e7ff;color:#3730a3; }
  .pill.secondary{background:#eff6ff;border-color:#dbeafe;color:#1e40af; }
  .pill.success{  background:#ecfdf5;border-color:#d1fae5;color:#065f46; }

  /* inside layout: header/top + grid fills remaining space and is balanced */
  .card-body{
    display:flex; flex-direction: column;
    gap: 1rem;      /* space between blurb and grid */
    height: 100%;
  }
  .card-body .top p{ margin: 0; color: #374151; }
  .grid-balanced{
    display:grid;
    gap:.65rem;
    align-content: space-between;  /* distributes rows vertically */
    grid-auto-rows: minmax(0, auto);
    min-height: 0;
    flex: 1 1 auto;
  }

  /* larger chips/swatches */
  .color-badge, .number-badge, .family-badge{
    display:flex; align-items:center; justify-content:center;
    height: 56px; border-radius: 14px; font-weight: 700;
    font-size: 1rem; letter-spacing:.2px;
    box-shadow: inset 0 0 0 1px rgba(15,23,42,.06);
  }
  .color-badge{ color:#fff; }
  .color-badge[style*="background:#ffffff"]{ color:#111 !important; }
  .color-badge[style*="background:#f1f5f9"]{ color:#111 !important; }
  .number-badge, .family-badge{ background: #0f172a0d; color:#0f172a; }
  .number-badge:hover, .family-badge:hover{
    transform: translateY(-1px);
    box-shadow: 0 8px 18px rgba(15,23,42,.12);
  }

  /* page header */
  .learn-h1{
    font-size: 3.2rem; font-weight: 900; margin-bottom: .75rem; color: var(--ink);
  }
  .learn-sub{
    font-size: 1.2rem; max-width: 90ch; margin: 0 auto;
    color: var(--white);
    text-shadow: 2px 2px 8px rgba(0,0,0,.8), 1px 1px 3px rgba(0,0,0,.9);
  }
</style>

<!-- Header -->
<section class="section animate-fade-in-up">
  <div class="container text-center">
    <h1 class="learn-h1">Learn Filipino Sign Language</h1>
    <p class="learn-sub">
      Discover essential vocabulary for Grade 1‚Äì3 learners through three core categories: Numbers, Colors, and Family.
    </p>
  </div>
</section>

<section class="section">
  <div class="container">

    <!-- ===== 3 equal cards; internals balanced ===== -->
    <div class="learn-grid">
      <!-- Colors -->
      <div class="category-card animate-fade-in-up" onclick="showCategory('colors')">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;">
            <h2 class="learn-title" style="color:var(--secondary);">üé® Colors</h2>
            <span class="pill secondary">13 Colors</span>
          </div>

          <div class="card-body">
            <div class="top">
              <p>Master kid-friendly color signs with visual prompts and demonstrations.</p>
            </div>

            <!-- 3 columns, rows auto and spaced to fill height -->
            <div class="grid-balanced" style="grid-template-columns:repeat(3,1fr);">
              <div class="color-badge" style="background:#000;">Black</div>
              <div class="color-badge" style="background:#3342ce;">Blue</div>
              <div class="color-badge" style="background:#5d4037;">Brown</div>
              <div class="color-badge" style="background:#111;">Dark</div>
              <div class="color-badge" style="background:#9ea7ad;">Gray</div>
              <div class="color-badge" style="background:#19694a;">Green</div>
              <div class="color-badge" style="background:#f1f5f9;color:#111;border:1px solid #e2e8f0;">Light</div>
              <div class="color-badge" style="background:#ef6c00;">Orange</div>
              <div class="color-badge" style="background:#ff7ab6;">Pink</div>
              <div class="color-badge" style="background:#ce2d2d;">Red</div>
              <div class="color-badge" style="background:#7e57c2;">Violet</div>
              <div class="color-badge" style="background:#ffffff;color:#15181a;border:1px solid #dee2e6;">White</div>
              <div class="color-badge" style="background:#ffe66d;color:#15181a;">Yellow</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Numbers -->
      <div class="category-card animate-fade-in-up" onclick="showCategory('numbers')" style="animation-delay:.06s;">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;">
            <h2 class="learn-title" style="color:var(--primary);">üî¢ Numbers</h2>
            <span class="pill primary">10 Classes</span>
          </div>

          <div class="card-body">
            <div class="top">
              <p>Learn the numbers One to Ten with step-by-step demos.</p>
            </div>

            <!-- EXACTLY 2 rows, spaced top/bottom -->
            <div class="grid-balanced" style="grid-template-columns:repeat(5,1fr);">
              <div class="number-badge">One</div>
              <div class="number-badge">Two</div>
              <div class="number-badge">Three</div>
              <div class="number-badge">Four</div>
              <div class="number-badge">Five</div>
              <div class="number-badge">Six</div>
              <div class="number-badge">Seven</div>
              <div class="number-badge">Eight</div>
              <div class="number-badge">Nine</div>
              <div class="number-badge">Ten</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Family -->
      <div class="category-card animate-fade-in-up" onclick="showCategory('family')" style="animation-delay:.12s;">
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:.5rem;">
            <h2 class="learn-title" style="color:var(--success);">üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family</h2>
            <span class="pill success">10 Terms</span>
          </div>

          <div class="card-body">
            <div class="top">
              <p>Learn common family terms used in daily life.</p>
            </div>

            <!-- 5 rows, evenly spaced vertically -->
            <div class="grid-balanced" style="grid-template-columns:repeat(2,1fr);">
              <div class="family-badge">Auntie</div>
              <div class="family-badge">Uncle</div>
              <div class="family-badge">Son</div>
              <div class="family-badge">Daughter</div>
              <div class="family-badge">Father</div>
              <div class="family-badge">Mother</div>
              <div class="family-badge">GrandMother</div>
              <div class="family-badge">GrandFather</div>
              <div class="family-badge">Cousin</div>
              <div class="family-badge">Parents</div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- /learn-grid -->

    <!-- Category Content -->
    <div id="categoryContent" class="category-content" style="display:none;margin-top:2rem;">
      <div class="card animate-fade-in-up" style="padding:1.5rem;border-radius:22px;">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.25rem;">
          <h2 id="contentTitle" style="margin:0;color:var(--primary);font-size:1.75rem;">üìö Category Content</h2>
          <button class="btn btn-outline" onclick="hideCategory()">‚Üê Back to Categories</button>
        </div>

        <!-- Numbers Content -->
        <div id="numbersContent" class="category-section">
          <p class="muted" style="margin-bottom:1.25rem;">Master numbers One to Ten with short demos.</p>

          <div class="number-range-selector" style="margin-bottom:1rem;">
            <h4 style="color:var(--secondary);margin-bottom:1rem;">Select Number:</h4>
            <div id="numberButtons" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:.8rem;margin-bottom:1.25rem;"></div>
          </div>

          <div class="video-container" style="margin-bottom:1.25rem;">
            <video id="numbersVideo" controls playsinline style="width:100%;max-height:440px;border-radius:16px;" muted onloadedmetadata="this.muted = true;">
              Your browser does not support the video tag.
            </video>
          </div>

          <div id="numberSteps" style="background:var(--neutral-50);padding:1.25rem;border-radius:16px;">
            <h4 style="color:var(--secondary);margin-bottom:.8rem;">üìã Learning Steps</h4>
            <ol id="numbersStepList" style="margin:0;padding-left:1.25rem;"></ol>
          </div>
        </div>

        <!-- Colors Content -->
        <div id="colorsContent" class="category-section" style="display:none;">
          <p class="muted" style="margin-bottom:1.25rem;">Learn color signs with visual demonstrations.</p>

          <div class="color-selector" style="margin-bottom:1.25rem;">
            <h4 style="color:var(--secondary);margin-bottom:1rem;">Select a Color to Learn:</h4>
            <div id="colorButtons" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));gap:.8rem;margin-bottom:1.25rem;"></div>
          </div>

          <div class="video-container" style="margin-bottom:1.25rem;">
            <video id="colorsVideo" controls playsinline style="width:100%;max-height:440px;border-radius:16px;" muted onloadedmetadata="this.muted = true;">
              Your browser does not support the video tag.
            </video>
          </div>

          <div style="background:var(--neutral-50);padding:1.25rem;border-radius:16px;">
            <h4 style="color:var(--secondary);margin-bottom:.8rem;">üìã Color Learning Steps</h4>
            <ol id="colorSteps" style="margin:0;padding-left:1.25rem;"></ol>
          </div>
        </div>

        <!-- Family Content -->
        <div id="familyContent" class="category-section" style="display:none;">
          <p class="muted" style="margin-bottom:1.25rem;">Learn essential family relationships and terms.</p>

          <div class="family-selector" style="margin-bottom:1.25rem;">
            <h4 style="color:var(--success);margin-bottom:1rem;">Select a Family Term:</h4>
            <div id="familyButtons" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(170px,1fr));gap:.8rem;margin-bottom:1.25rem;"></div>
          </div>

          <div class="video-container" style="margin-bottom:1.25rem;">
            <video id="familyVideo" controls playsinline style="width:100%;max-height:440px;border-radius:16px;" muted onloadedmetadata="this.muted = true;">
              Your browser does not support the video tag.
            </video>
          </div>

          <div style="background:var(--neutral-50);padding:1.25rem;border-radius:16px;">
            <h4 style="color:var(--success);margin-bottom:.8rem;">üìã Family Learning Steps</h4>
            <ol id="familySteps" style="margin:0;padding-left:1.25rem;"></ol>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- CTA -->
<section class="section" style="background:var(--neutral-50);">
  <div class="container text-center">
    <h2 class="animate-fade-in-up" style="color:var(--primary);margin-bottom:1.25rem;">Ready to Practice Your Signs?</h2>
    <div class="animate-fade-in-up animate-delay-1">
      <a class="btn" href="{{ url_for('home') }}" style="margin-right:1rem;background:var(--primary);"> ‚Üê Back to Home</a>
      <a class="btn btn-outline" href="{{ url_for('activity') }}" style="background:var(--accent);color:white;border-color:var(--accent);">Start Activity ‚Üí</a>
    </div>
  </div>
</section>

<script>
  /* Data sets */
  const NUMBERS = ["one","two","three","four","five","six","seven","eight","nine","ten"];
  const COLORS  = ["black","blue","brown","dark","gray","green","light","orange","pink","red","violet","white","yellow"];
  const FAMILY  = ["auntie","uncle","son","daughter","father","mother","grandmother","grandfather","cousin","parents"];

  const titleCase = s => s.charAt(0).toUpperCase() + s.slice(1);

  /* -------- manifest loader + helpers -------- */
  let VIDEO = null; // { colors: {black:[...]} , numbers:{...}, family:{...} }
  async function loadManifest(){
    if (VIDEO) return VIDEO;
    try{
      const res = await fetch("/static/manifest.json?v=1");
      VIDEO = await res.json();
    }catch(e){
      console.warn("Manifest not found, using fallback paths.", e);
      VIDEO = {};
    }
    return VIDEO;
  }
  function pickRandom(arr){ return (arr && arr.length) ? arr[Math.floor(Math.random()*arr.length)] : null; }
  function posterFromSrc(src){
    // /static/video/colors/black_01.mp4 -> /static/posters/colors/black_01.jpg
    return src.replace('/static/video/', '/static/posters/').replace(/\.mp4$/i, '.jpg');
  }

  /* Routing between the three content panes */
  function showCategory(category) {
    const contentArea = document.getElementById('categoryContent');
    const categoriesGrid = document.querySelector('.learn-grid');
    categoriesGrid.style.display = 'none';
    contentArea.style.display = 'block';

    document.getElementById('numbersContent').style.display = 'none';
    document.getElementById('colorsContent').style.display  = 'none';
    document.getElementById('familyContent').style.display  = 'none';

    if (category === 'numbers') {
      document.getElementById('contentTitle').innerHTML = 'üî¢ Numbers Learning Module';
      document.getElementById('numbersContent').style.display = 'block';
      if (!document.getElementById('numberButtons').dataset.init) initNumbers();
    } else if (category === 'colors') {
      document.getElementById('contentTitle').innerHTML = 'üé® Colors Learning Module';
      document.getElementById('colorsContent').style.display = 'block';
      if (!document.getElementById('colorButtons').dataset.init) initColors();
    } else if (category === 'family') {
      document.getElementById('contentTitle').innerHTML = 'üë®‚Äçüë©‚Äçüëß‚Äçüë¶ Family Learning Module';
      document.getElementById('familyContent').style.display = 'block';
      if (!document.getElementById('familyButtons').dataset.init) initFamily();
    }
  }

  function hideCategory() {
    document.querySelector('.learn-grid').style.display = 'grid';
    document.getElementById('categoryContent').style.display = 'none';
  }

  /* Numbers */
  function initNumbers(){
    const wrap = document.getElementById('numberButtons');
    wrap.dataset.init = '1';
    NUMBERS.forEach(n=>{
      const b = document.createElement('button');
      b.className = 'btn btn-outline';
      b.textContent = titleCase(n);
      b.onclick = ()=> loadNumber(n);
      wrap.appendChild(b);
    });
    loadNumber('one');
  }
  async function loadNumber(n){
    await loadManifest();
    document.querySelectorAll('#numberButtons .btn').forEach(btn=>{
      btn.classList.remove('btn-primary'); btn.classList.add('btn-outline');
      if(btn.textContent.toLowerCase()===n) { btn.classList.add('btn-primary'); btn.classList.remove('btn-outline'); }
    });
    const video = document.getElementById('numbersVideo');
    const steps = document.getElementById('numbersStepList');

    const list = VIDEO?.numbers?.[n];
    const src  = pickRandom(list) || `/static/video/numbers/${n}.mp4`;
    const poster = posterFromSrc(src);

    video.src = src;
    video.poster = poster;
    video.load(); // NO autoplay

    const SAMPLE = [
      'Face the camera with clear hands.',
      'Form the correct handshape for the number.',
      'Move once, hold briefly, then relax.',
    ];
    steps.innerHTML = '';
    SAMPLE.forEach(s=>{ const li=document.createElement('li'); li.textContent=s; steps.appendChild(li); });
  }

  /* Colors */
  function initColors(){
    const wrap = document.getElementById('colorButtons');
    wrap.dataset.init = '1';
    COLORS.forEach(c=>{
      const b = document.createElement('button');
      b.className = 'btn btn-outline';
      b.textContent = titleCase(c);
      b.onclick = ()=> loadColor(c);
      wrap.appendChild(b);
    });
    loadColor('red');
  }
  async function loadColor(c){
    await loadManifest();
    document.querySelectorAll('#colorButtons .btn').forEach(btn=>{
      btn.classList.remove('btn-primary'); btn.classList.add('btn-outline');
      if(btn.textContent.toLowerCase()===c) { btn.classList.add('btn-primary'); btn.classList.remove('btn-outline'); }
    });
    const video = document.getElementById('colorsVideo');
    const steps = document.getElementById('colorSteps');

    const list = VIDEO?.colors?.[c];
    const src  = pickRandom(list) || `/static/video/colors/${c}.mp4`;
    const poster = posterFromSrc(src);

    video.src = src;
    video.poster = poster;
    video.load(); // NO autoplay

    const SAMPLE = [
      'Start with neutral hand position.',
      'Perform the handshape/motion for the color.',
      'Hold the final pose briefly.',
    ];
    steps.innerHTML = '';
    SAMPLE.forEach(s=>{ const li=document.createElement('li'); li.textContent=s; steps.appendChild(li); });
  }

  /* Family */
  function initFamily(){
    const wrap = document.getElementById('familyButtons');
    wrap.dataset.init = '1';
    FAMILY.forEach(f=>{
      const b = document.createElement('button');
      b.className = 'btn btn-outline';
      b.textContent = f.split('_').map(titleCase).join(' ');
      b.onclick = ()=> loadFamily(f);
      wrap.appendChild(b);
    });
    loadFamily('mother');
  }
  async function loadFamily(fm){
    await loadManifest();
    document.querySelectorAll('#familyButtons .btn').forEach(btn=>{
      btn.classList.remove('btn-primary'); btn.classList.add('btn-outline');
      if(btn.textContent.toLowerCase().replace(/\s+/g,'')===fm.replace('_','')) {
        btn.classList.add('btn-primary'); btn.classList.remove('btn-outline');
      }
    });
    const video = document.getElementById('familyVideo');
    const steps = document.getElementById('familySteps');

    const list = VIDEO?.family?.[fm];
    const src  = pickRandom(list) || `/static/video/family/${fm}.mp4`;
    const poster = posterFromSrc(src);

    video.src = src;
    video.poster = poster;
    video.load(); // NO autoplay

    const SAMPLE = [
      'Face the camera clearly.',
      'Perform the handshape/motion for the term.',
      'Hold the final pose briefly.',
    ];
    steps.innerHTML = '';
    SAMPLE.forEach(s=>{ const li=document.createElement('li'); li.textContent=s; steps.appendChild(li); });
  }
</script>

{% endblock %}
